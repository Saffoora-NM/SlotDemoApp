# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- none

pool:
  vmImage: ubuntu-latest

jobs:
- job: buildJob
  steps:
  - task: DotNetCoreCLI@2
    inputs:
      command: 'build'
      projects: '**/*.csproj'

  - task: DotNetCoreCLI@2
    inputs:
      command: 'publish'
      publishWebProjects: true
      arguments: '-c Release -o $(Pipeline.Workspace)'

  - task: PublishPipelineArtifact@1
    inputs:
      targetPath: '$(Pipeline.Workspace)'
      artifact: 'code'
      publishLocation: 'pipeline'

  - task: DownloadPipelineArtifact@2
    inputs:
      buildType: 'current'
      artifactName: 'code'
      targetPath: '$(Pipeline.Workspace)'

- job: deployJob
  dependsOn: buildJob
  steps:
  - task: AzureRmWebAppDeployment@5
    inputs:
      ConnectionType: 'AzureRM'
      azureSubscription: 'AZD-RWD-DEV7'
      appType: 'webAppLinux'
      WebAppName: 'demo-slot'
      deployToSlotOrASE: true
      ResourceGroupName: 'DEVRWDWEBRG7401'
      SlotName: 'staging'
      packageForLinux: '$(System.DefaultWorkingDirectory)/**/*.zip'
      DeploymentTypeLinux: 'oneDeploy'
